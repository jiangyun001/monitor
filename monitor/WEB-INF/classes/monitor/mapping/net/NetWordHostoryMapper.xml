<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="monitor.dao.net.NetWordHostoryMapper">
  <resultMap id="BaseResultMap" type="monitor.pojo.net.NetWordHostory">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="key_word" jdbcType="VARCHAR" property="keyWord" />
    <result column="net_address" jdbcType="VARCHAR" property="netAddress" />
    <result column="word_order" jdbcType="VARCHAR" property="wordOrder" />
    <result column="uper_order" jdbcType="VARCHAR" property="uperOrder" />
    <result column="cur_fee" jdbcType="VARCHAR" property="curFee" />
    <result column="rach_order" jdbcType="VARCHAR" property="rachOrder" />
    <result column="order_time" jdbcType="VARCHAR" property="orderTime" />
    <result column="dep_id" jdbcType="INTEGER" property="depId" />
    <result column="role_id" jdbcType="INTEGER" property="roleId" />
    <result column="word_custmer" jdbcType="VARCHAR" property="wordCustmer" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, key_word, net_address, word_order, uper_order, cur_fee, rach_order, order_time, 
    dep_id, role_id, word_custmer
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from net_word_hostory
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from net_word_hostory
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="monitor.pojo.net.NetWordHostory">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into net_word_hostory (id, key_word, net_address, 
      word_order, uper_order, cur_fee, 
      rach_order, order_time, dep_id, 
      role_id, word_custmer)
    values (#{id,jdbcType=INTEGER}, #{keyWord,jdbcType=VARCHAR}, #{netAddress,jdbcType=VARCHAR}, 
      #{wordOrder,jdbcType=VARCHAR}, #{uperOrder,jdbcType=VARCHAR}, #{curFee,jdbcType=VARCHAR}, 
      #{rachOrder,jdbcType=VARCHAR}, #{orderTime,jdbcType=VARCHAR}, #{depId,jdbcType=INTEGER}, 
      #{roleId,jdbcType=INTEGER}, #{wordCustmer,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="monitor.pojo.net.NetWordHostory">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into net_word_hostory
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="keyWord != null">
        key_word,
      </if>
      <if test="netAddress != null">
        net_address,
      </if>
      <if test="wordOrder != null">
        word_order,
      </if>
      <if test="uperOrder != null">
        uper_order,
      </if>
      <if test="curFee != null">
        cur_fee,
      </if>
      <if test="rachOrder != null">
        rach_order,
      </if>
      <if test="orderTime != null">
        order_time,
      </if>
      <if test="depId != null">
        dep_id,
      </if>
      <if test="roleId != null">
        role_id,
      </if>
      <if test="wordCustmer != null">
        word_custmer,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="keyWord != null">
        #{keyWord,jdbcType=VARCHAR},
      </if>
      <if test="netAddress != null">
        #{netAddress,jdbcType=VARCHAR},
      </if>
      <if test="wordOrder != null">
        #{wordOrder,jdbcType=VARCHAR},
      </if>
      <if test="uperOrder != null">
        #{uperOrder,jdbcType=VARCHAR},
      </if>
      <if test="curFee != null">
        #{curFee,jdbcType=VARCHAR},
      </if>
      <if test="rachOrder != null">
        #{rachOrder,jdbcType=VARCHAR},
      </if>
      <if test="orderTime != null">
        #{orderTime,jdbcType=VARCHAR},
      </if>
      <if test="depId != null">
        #{depId,jdbcType=INTEGER},
      </if>
      <if test="roleId != null">
        #{roleId,jdbcType=INTEGER},
      </if>
      <if test="wordCustmer != null">
        #{wordCustmer,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="monitor.pojo.net.NetWordHostory">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update net_word_hostory
    <set>
      <if test="keyWord != null">
        key_word = #{keyWord,jdbcType=VARCHAR},
      </if>
      <if test="netAddress != null">
        net_address = #{netAddress,jdbcType=VARCHAR},
      </if>
      <if test="wordOrder != null">
        word_order = #{wordOrder,jdbcType=VARCHAR},
      </if>
      <if test="uperOrder != null">
        uper_order = #{uperOrder,jdbcType=VARCHAR},
      </if>
      <if test="curFee != null">
        cur_fee = #{curFee,jdbcType=VARCHAR},
      </if>
      <if test="rachOrder != null">
        rach_order = #{rachOrder,jdbcType=VARCHAR},
      </if>
      <if test="orderTime != null">
        order_time = #{orderTime,jdbcType=VARCHAR},
      </if>
      <if test="depId != null">
        dep_id = #{depId,jdbcType=INTEGER},
      </if>
      <if test="roleId != null">
        role_id = #{roleId,jdbcType=INTEGER},
      </if>
      <if test="wordCustmer != null">
        word_custmer = #{wordCustmer,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="monitor.pojo.net.NetWordHostory">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update net_word_hostory
    set key_word = #{keyWord,jdbcType=VARCHAR},
      net_address = #{netAddress,jdbcType=VARCHAR},
      word_order = #{wordOrder,jdbcType=VARCHAR},
      uper_order = #{uperOrder,jdbcType=VARCHAR},
      cur_fee = #{curFee,jdbcType=VARCHAR},
      rach_order = #{rachOrder,jdbcType=VARCHAR},
      order_time = #{orderTime,jdbcType=VARCHAR},
      dep_id = #{depId,jdbcType=INTEGER},
      role_id = #{roleId,jdbcType=INTEGER},
      word_custmer = #{wordCustmer,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
   <select id="getPageWordHostory"  parameterType="monitor.pojo.net.PageModel"  resultMap="BaseResultMap">
  	<!-- Base_Column_List -->
  	select <include refid="Base_Column_List" /> from net_word_hostory where 1=1 
  	<include refid="conditionPage"/>
  	<if test="pageNumber != null and  pageSize!= null">
   		limit #{startRow},#{pageSize}
      </if>
  </select>
  
  <select id="getPageWordHostoryCount"  parameterType="monitor.pojo.net.PageModel"  resultType="java.lang.Integer">
  	<!-- Base_Column_List -->
  	select count(0) from  net_word_hostory where 1=1
  	<include refid="conditionPage"/> 
  	<if test="pageNumber != null and  pageSize!= null">
   		limit #{startRow},#{pageSize}
      </if>
  </select>
  
   <sql id="conditionPage">
   
      <if test="queryObj.netAddress != null and queryObj.keyWord != null and queryObj.notLike==null" >
      	 and word_order &lt;10 and uper_order &gt;10 
      	 and (net_address like concat ('%',#{queryObj.netAddress},'%') or key_word like concat ('%',#{queryObj.keyWord},'%'))
      </if>
     <if test="queryObj.netAddress != null and queryObj.keyWord != null and queryObj.notLike!=null" >
      	 and net_address = #{queryObj.netAddress} and key_word=#{queryObj.keyWord}
      </if>
      <if test="queryObj.orderTime != null" >
        and order_time=#{queryObj.orderTime}
      </if>
      <if test="queryObj.roleId!= null and queryObj.roleId!=1 and queryObj.roleId!=0"  >
      	and role_id=#{queryObj.roleId}
      </if>
	  <if test="queryObj.roleId!= null and queryObj.depId!=1 and queryObj.depId!=0 " >
        and dep_id=#{queryObj.depId}
      </if>
      <if test="queryObj.wordCustmer != null" >
        and word_custmer=#{queryObj.wordCustmer}
      </if>
      
      <if test="queryObj.startData != null and queryObj.startData !='' and queryObj.endData!=null and queryObj.endData !=''">
      	and order_time &gt;=#{queryObj.startData} and order_time &lt;=#{queryObj.endData}
      </if>
      <if test="queryObj.serachKey!=null and queryObj.serachKey!=''">
        and (key_word like concat('%',#{queryObj.serachKey},'%') or net_address like concat('%',#{queryObj.serachKey},'%'))
      </if>
      <if test="queryObj.firstPage=='first'">
        and word_order &lt; 10 and uper_order &gt; 10
      </if>
      
  </sql>
  
  <select id="getNetWordTitle" parameterType="String" resultType="monitor.pojo.net.NetWord">
  	select key_word as keyWord,user_money as userMoney,proxy_money as proxyMoney,target_order as targetOrder from net_word where key_word=#{keyWord} and net_address = #{netAddress}
  </select>
  
  <select id="getNetDayTitles" parameterType="monitor.pojo.net.NetWord" resultType="monitor.pojo.net.NetDayTitle">
  	select 
		substr(create_time,1,8) as date,
		sum(case when flag='优化中(排队中)' then 1 else 0 end) as queuing,
		sum(case when flag='优化中(处理中)' then 1 else 0 end) as processing,
		sum(case when flag='优化中(申请取消)' then 1 else 0 end) as becaceing,
		sum(case when flag='优化中(取消中)' then 1 else 0 end) as becamceled,
		sum(case when flag='不通过' then 1 else 0 end) as nopass,
		sum(case when flag='停止优化(申请恢复)' then 1 else 0 end) as stopbeter,
		sum(case when flag='停止优化(恢复中)' then 1 else 0 end) as stopbetering
	from 
		net_word where 1=1 
		<if test="depId>1 and roleId==1">
			and dep_id=#{depId}
		</if>
		<if test="roleId>1">
			and word_custmer=#{wordCustmer}
		</if>
		group by substr(create_time,1,8) order by substr(create_time,1,8) DESC
  </select>
  
  <select id="upOrder" parameterType="String" resultMap="BaseResultMap">
  	select <include refid="Base_Column_List"/> from  net_word_hostory where id=(select max(id) from net_word_hostory where key_word=#{word} and net_address=#{netAddress}) 
  </select>
  <!-- String upOrder(String word ,String netAddress); -->
</mapper>